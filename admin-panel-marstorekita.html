<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Marstorekita Robux</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Google Apps Script API -->
<script>
// Konfigurasi Google Apps Script
const GAS_CONFIG = {
scriptUrl: "https://script.google.com/macros/s/AKfycbx5DV-HqFAvQjMZj4-IYUFv9k6XlfXxndh3ycO1fbpPMkVhoRD9xF5ihktFCBYAhA/exec",
secretKey: "MARSTORE_KITA_2023"
};
// Fungsi untuk memanggil Google Apps Script
async function callGoogleAppsScript(action, data = {}) {
  try {
    const params = new URLSearchParams({
      action: action,
      key: GAS_CONFIG.secretKey,
      ...data
    });
    
    const response = await fetch(`${GAS_CONFIG.scriptUrl}?${params}`, {
      method: 'GET',
      redirect: 'follow'
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const result = await response.json();
    return result;
  } catch (error) {
    console.error('Error calling Google Apps Script:', error);
    throw error;
  }
}
// Fungsi untuk mengirim data ke Google Apps Script (POST)
async function postDataToGoogleAppsScript(action, data = {}) {
  try {
    const formData = new FormData();
    formData.append('action', action);
    formData.append('key', GAS_CONFIG.secretKey);
    
    // Tambahkan semua data ke form
    Object.keys(data).forEach(key => {
      formData.append(key, data[key]);
    });
    
    const response = await fetch(GAS_CONFIG.scriptUrl, {
      method: 'POST',
      body: formData,
      mode: 'no-cors', // Tambahkan mode no-cors untuk mengatasi CORS
      redirect: 'follow'
    });
    
    // Karena menggunakan mode no-cors, kita tidak bisa membaca response
    // Jadi kita asumsikan berhasil jika tidak ada error
    return "Success";
  } catch (error) {
    console.error('Error posting data to Google Apps Script:', error);
    throw error;
  }
}
</script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
body {
font-family: 'Inter', sans-serif;
}
.sidebar {
transition: all 0.3s ease;
}
.sidebar.collapsed {
width: 80px;
}
.sidebar.collapsed .sidebar-text {
display: none;
}
.status-badge {
font-size: 0.75rem;
padding: 0.25rem 0.75rem;
border-radius: 9999px;
font-weight: 600;
}
.status-pending {
background-color: #fef3c7;
color: #92400e;
}
.status-completed {
background-color: #d1fae5;
color: #065f46;
}
.status-failed {
background-color: #fee2e2;
color: #991b1b;
}
.transaction-row:hover {
background-color: #f9fafb;
}
.loading-spinner {
border: 3px solid #f3f3f3;
border-top: 3px solid #3b82f6;
border-radius: 50%;
width: 40px;
height: 40px;
animation: spin 1s linear infinite;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
.debug-panel {
background-color: #1e293b;
color: #e2e8f0;
font-family: monospace;
font-size: 0.875rem;
max-height: 300px;
overflow-y: auto;
}
.debug-log {
padding: 0.5rem;
border-bottom: 1px solid #334155;
}
.debug-log:last-child {
border-bottom: none;
}
.debug-error {
color: #f87171;
}
.debug-success {
color: #4ade80;
}
.debug-info {
color: #60a5fa;
}
.notification-badge {
position: absolute;
top: -5px;
right: -5px;
background: #ef4444;
color: white;
border-radius: 50%;
width: 20px;
height: 20px;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.75rem;
font-weight: bold;
}
</style>
</head>
<body class="bg-gray-100">
<!-- Login Screen -->
<div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gray-100">
<div class="max-w-md w-full bg-white rounded-xl shadow-lg p-8">
<div class="text-center mb-8">
<div class="w-16 h-16 bg-green-500 rounded-lg flex items-center justify-center mx-auto mb-4">
<i class="fas fa-gamepad text-white text-2xl"></i>
</div>
<h1 class="text-2xl font-bold text-gray-800">Admin Panel</h1>
<p class="text-gray-600">Marstorekita Robux</p>
</div>
<form onsubmit="login(event)">
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
<input type="password" id="adminPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan password admin">
</div>
<button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-medium">
<i class="fas fa-sign-in-alt mr-2"></i>Login
</button>
</form>
<div class="mt-6 text-center text-sm text-gray-500">
<p>Default password: <span class="font-mono bg-gray-100 px-2 py-1 rounded">admin123</span></p>
</div>
</div>
</div>
<!-- Admin Dashboard -->
<div id="adminDashboard" class="hidden min-h-screen flex">
<!-- Sidebar -->
<div id="sidebar" class="sidebar w-64 bg-gray-800 text-white">
<div class="p-4 border-b border-gray-700">
<div class="flex items-center space-x-3">
<div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
<i class="fas fa-gamepad text-white"></i>
</div>
<div class="sidebar-text">
<h2 class="font-bold text-lg">Marstorekita</h2>
<p class="text-xs text-gray-400">Admin Panel</p>
</div>
</div>
</div>
<nav class="p-4">
<a href="#" onclick="showSection('transactions')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition mb-2 bg-gray-700 relative">
<i class="fas fa-exchange-alt w-5"></i>
<span class="sidebar-text">Transaksi</span>
<span id="transactionNotification" class="notification-badge hidden">0</span>
</a>
<a href="#" onclick="showSection('analytics')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition mb-2">
<i class="fas fa-chart-bar w-5"></i>
<span class="sidebar-text">Analitik</span>
</a>
<a href="#" onclick="showSection('settings')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition mb-2">
<i class="fas fa-cog w-5"></i>
<span class="sidebar-text">Pengaturan</span>
</a>
<a href="#" onclick="showSection('debug')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition mb-2">
<i class="fas fa-bug w-5"></i>
<span class="sidebar-text">Debug</span>
</a>
</nav>
<div class="absolute bottom-0 w-64 p-4 border-t border-gray-700">
<button onclick="logout()" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition w-full">
<i class="fas fa-sign-out-alt w-5"></i>
<span class="sidebar-text">Logout</span>
</button>
</div>
</div>
<!-- Main Content -->
<div class="flex-1 flex flex-col overflow-hidden">
<!-- Top Bar -->
<header class="bg-white shadow-sm">
<div class="flex items-center justify-between p-4">
<button onclick="toggleSidebar()" class="text-gray-600 hover:text-gray-800">
<i class="fas fa-bars text-xl"></i>
</button>
<div class="flex items-center space-x-4">
<span class="text-gray-700">Admin</span>
<div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
<i class="fas fa-user text-white text-sm"></i>
</div>
</div>
</div>
</header>
<!-- Main Content Area -->
<main class="flex-1 overflow-y-auto p-6 bg-gray-100">
<!-- Transactions Section -->
<div id="transactionsSection" class="section">
<div class="bg-white rounded-xl shadow-sm p-6 mb-6">
<div class="flex justify-between items-center mb-6">
<h2 class="text-xl font-bold text-gray-800">Daftar Transaksi</h2>
<div class="flex space-x-3">
<div class="relative">
<input type="text" id="searchTransaction" placeholder="Cari transaksi..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
<i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
</div>
<button onclick="refreshTransactions()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
<i class="fas fa-sync-alt mr-2"></i>Refresh
</button>
<button onclick="exportTransactions()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
<i class="fas fa-download mr-2"></i>Export
</button>
</div>
</div>
<div class="overflow-x-auto">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pengguna</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah Robux</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Metode</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
</tr>
</thead>
<tbody id="transactionsTableBody" class="bg-white divide-y divide-gray-200">
<!-- Transactions will be loaded here -->
</tbody>
</table>
</div>
<div id="transactionsLoading" class="flex justify-center items-center py-12 hidden">
<div class="loading-spinner"></div>
</div>
<div id="transactionsEmpty" class="text-center py-12 hidden">
<i class="fas fa-inbox text-gray-400 text-4xl mb-4"></i>
<p class="text-gray-500">Tidak ada transaksi ditemukan</p>
</div>
</div>
</div>
<!-- Analytics Section -->
<div id="analyticsSection" class="section hidden">
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
<div class="bg-white rounded-xl shadow-sm p-6">
<div class="flex items-center">
<div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
<i class="fas fa-exchange-alt text-xl"></i>
</div>
<div>
<p class="text-gray-500 text-sm">Total Transaksi</p>
<p id="totalTransactions" class="text-2xl font-bold">0</p>
</div>
</div>
</div>
<div class="bg-white rounded-xl shadow-sm p-6">
<div class="flex items-center">
<div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
<i class="fas fa-check-circle text-xl"></i>
</div>
<div>
<p class="text-gray-500 text-sm">Transaksi Berhasil</p>
<p id="completedTransactions" class="text-2xl font-bold">0</p>
</div>
</div>
</div>
<div class="bg-white rounded-xl shadow-sm p-6">
<div class="flex items-center">
<div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
<i class="fas fa-clock text-xl"></i>
</div>
<div>
<p class="text-gray-500 text-sm">Menunggu Proses</p>
<p id="pendingTransactions" class="text-2xl font-bold">0</p>
</div>
</div>
</div>
<div class="bg-white rounded-xl shadow-sm p-6">
<div class="flex items-center">
<div class="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
<i class="fas fa-dollar-sign text-xl"></i>
</div>
<div>
<p class="text-gray-500 text-sm">Total Pendapatan</p>
<p id="totalRevenue" class="text-2xl font-bold">Rp 0</p>
</div>
</div>
</div>
</div>
<div class="bg-white rounded-xl shadow-sm p-6 mb-6">
<h3 class="text-lg font-bold text-gray-800 mb-4">Grafik Transaksi Harian</h3>
<div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
<canvas id="transactionChart" width="400" height="200"></canvas>
</div>
</div>
<div class="bg-white rounded-xl shadow-sm p-6">
<h3 class="text-lg font-bold text-gray-800 mb-4">Transaksi Terbaru</h3>
<div class="overflow-x-auto">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pengguna</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
</tr>
</thead>
<tbody id="recentTransactionsTable" class="bg-white divide-y divide-gray-200">
<!-- Recent transactions will be loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Settings Section -->
<div id="settingsSection" class="section hidden">
<div class="bg-white rounded-xl shadow-sm p-6 mb-6">
<h2 class="text-xl font-bold text-gray-800 mb-6">Pengaturan Admin</h2>
<div class="mb-6">
<h3 class="text-lg font-medium text-gray-800 mb-4">Ubah Password</h3>
<form onsubmit="changePassword(event)">
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Password Baru</label>
<input type="password" id="newPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan password baru">
</div>
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password</label>
<input type="password" id="confirmPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Konfirmasi password baru">
</div>
<button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
<i class="fas fa-save mr-2"></i>Simpan Password
</button>
</form>
</div>
<div class="border-t border-gray-200 pt-6">
<h3 class="text-lg font-medium text-gray-800 mb-4">Pengaturan Sistem</h3>
<div class="space-y-4">
<div class="flex items-center justify-between">
<div>
<p class="font-medium text-gray-800">Notifikasi Transaksi Baru</p>
<p class="text-sm text-gray-500">Aktifkan notifikasi untuk transaksi baru</p>
</div>
<label class="relative inline-flex items-center cursor-pointer">
<input type="checkbox" id="notificationToggle" class="sr-only peer" checked>
<div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
</label>
</div>
<div class="flex items-center justify-between">
<div>
<p class="font-medium text-gray-800">Auto Refresh</p>
<p class="text-sm text-gray-500">Refresh otomatis setiap 30 detik</p>
</div>
<label class="relative inline-flex items-center cursor-pointer">
<input type="checkbox" id="autoRefreshToggle" class="sr-only peer">
<div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
</label>
</div>
</div>
</div>
</div>
</div>
<!-- Debug Section -->
<div id="debugSection" class="section hidden">
<div class="bg-white rounded-xl shadow-sm p-6 mb-6">
<div class="flex justify-between items-center mb-6">
<h2 class="text-xl font-bold text-gray-800">Debug Panel</h2>
<button onclick="clearDebugLogs()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
<i class="fas fa-trash mr-2"></i>Hapus Log
</button>
</div>
<div class="mb-4">
<div class="flex space-x-2">
<button onclick="addDebugLog('info', 'Ini adalah log informasi')" class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200 transition">
<i class="fas fa-info-circle mr-1"></i>Info
</button>
<button onclick="addDebugLog('success', 'Operasi berhasil dilakukan')" class="bg-green-100 text-green-800 px-3 py-1 rounded text-sm hover:bg-green-200 transition">
<i class="fas fa-check-circle mr-1"></i>Success
</button>
<button onclick="addDebugLog('error', 'Terjadi kesalahan pada sistem')" class="bg-red-100 text-red-800 px-3 py-1 rounded text-sm hover:bg-red-200 transition">
<i class="fas fa-exclamation-circle mr-1"></i>Error
</button>
</div>
</div>
<div id="debugPanel" class="debug-panel rounded-lg">
<div class="debug-log debug-info">
<span class="text-gray-400">[2023-06-15 10:30:45]</span> <span class="debug-info">INFO:</span> Google Apps Script initialized successfully
</div>
<div class="debug-log debug-success">
<span class="text-gray-400">[2023-06-15 10:31:02]</span> <span class="debug-success">SUCCESS:</span> Admin login successful
</div>
<div class="debug-log debug-info">
<span class="text-gray-400">[2023-06-15 10:31:15]</span> <span class="debug-info">INFO:</span> Loaded 12 transactions
</div>
</div>
</div>
<div class="bg-white rounded-xl shadow-sm p-6">
<h3 class="text-lg font-bold text-gray-800 mb-4">Google Apps Script Status</h3>
<div class="space-y-3">
<div class="flex justify-between">
<span class="text-gray-600">Connection Status</span>
<span class="text-green-600 font-medium">Connected</span>
</div>
<div class="flex justify-between">
<span class="text-gray-600">Last Sync</span>
<span id="lastSync" class="text-gray-800">-</span>
</div>
<div class="flex justify-between">
<span class="text-gray-600">Data Loaded</span>
<span id="dataLoaded" class="text-gray-800">0 transactions</span>
</div>
</div>
</div>
</div>
</main>
</div>
</div>
<!-- Notification Toast -->
<div id="notificationToast" class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 transform translate-y-20 opacity-0 transition-all duration-300 max-w-md">
<div class="flex items-start">
<div id="notificationIcon" class="flex-shrink-0 w-6 h-6 mr-3 mt-0.5">
<!-- Icon will be set dynamically -->
</div>
<div class="flex-1">
<h4 id="notificationTitle" class="font-medium text-gray-900"></h4>
<p id="notificationMessage" class="mt-1 text-sm text-gray-500"></p>
</div>
<button onclick="hideNotification()" class="ml-4 text-gray-400 hover:text-gray-500">
<i class="fas fa-times"></i>
</button>
</div>
</div>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Global variables
let currentSection = 'transactions';
let transactions = [];
let debugLogs = [];
let autoRefreshInterval = null;
let notificationEnabled = true;
let chart = null;
// Initialize the app
document.addEventListener('DOMContentLoaded', function() {
// Check if already logged in
if (localStorage.getItem('adminLoggedIn') === 'true') {
showDashboard();
loadTransactions();
setupAutoRefresh();
}
});
// Login function
function login(event) {
event.preventDefault();
const password = document.getElementById('adminPassword').value;
// Simple password check (in real app, use proper authentication)
if (password === 'admin123') {
localStorage.setItem('adminLoggedIn', 'true');
showDashboard();
loadTransactions();
setupAutoRefresh();
showNotification('success', 'Login Berhasil', 'Selamat datang di admin panel');
addDebugLog('success', 'Admin login successful');
} else {
showNotification('error', 'Login Gagal', 'Password yang Anda masukkan salah');
addDebugLog('error', 'Failed login attempt with wrong password');
}
}
// Logout function
function logout() {
localStorage.removeItem('adminLoggedIn');
// Clear auto refresh
if (autoRefreshInterval) {
clearInterval(autoRefreshInterval);
autoRefreshInterval = null;
}
document.getElementById('loginScreen').classList.remove('hidden');
document.getElementById('adminDashboard').classList.add('hidden');
showNotification('info', 'Logout Berhasil', 'Anda telah keluar dari admin panel');
addDebugLog('info', 'Admin logged out');
}
// Show dashboard after login
function showDashboard() {
document.getElementById('loginScreen').classList.add('hidden');
document.getElementById('adminDashboard').classList.remove('hidden');
}
// Toggle sidebar
function toggleSidebar() {
const sidebar = document.getElementById('sidebar');
sidebar.classList.toggle('collapsed');
}
// Show section
function showSection(sectionName) {
// Hide all sections
document.querySelectorAll('.section').forEach(section => {
section.classList.add('hidden');
});
// Show selected section
document.getElementById(sectionName + 'Section').classList.remove('hidden');
// Update active nav item
document.querySelectorAll('nav a').forEach(item => {
item.classList.remove('bg-gray-700');
});
event.target.closest('a').classList.add('bg-gray-700');
currentSection = sectionName;
// Load section-specific data
if (sectionName === 'transactions') {
loadTransactions();
} else if (sectionName === 'analytics') {
loadAnalytics();
} else if (sectionName === 'debug') {
loadDebugLogs();
}
}
// Setup auto refresh
function setupAutoRefresh() {
const toggle = document.getElementById('autoRefreshToggle');
toggle.addEventListener('change', function() {
if (this.checked) {
autoRefreshInterval = setInterval(() => {
if (currentSection === 'transactions') {
loadTransactions();
} else if (currentSection === 'analytics') {
loadAnalytics();
}
addDebugLog('info', 'Auto refresh triggered');
}, 30000); // 30 seconds
} else {
if (autoRefreshInterval) {
clearInterval(autoRefreshInterval);
autoRefreshInterval = null;
}
}
});
}
// Load transactions from Google Sheets
async function loadTransactions() {
const tableBody = document.getElementById('transactionsTableBody');
const loadingElement = document.getElementById('transactionsLoading');
const emptyElement = document.getElementById('transactionsEmpty');
// Show loading
tableBody.innerHTML = '';
loadingElement.classList.remove('hidden');
emptyElement.classList.add('hidden');
try {
// Get transactions from Google Sheets via Google Apps Script
const response = await callGoogleAppsScript("getTransactions");
console.log("Response dari Google Apps Script:", response);
// Cek jika response kosong atau bukan array
if (!response || !Array.isArray(response) || response.length === 0) {
// Coba load dari localStorage sebagai fallback
const localTransactions = JSON.parse(localStorage.getItem("transactionHistory") || "[]");
if (localTransactions.length > 0) {
transactions = localTransactions;
populateTransactionsTable();
loadingElement.classList.add('hidden');
showNotification('info', 'Data Lokal', 'Menampilkan data dari localStorage karena Google Sheets tidak dapat diakses');
addDebugLog('info', `Loaded ${localTransactions.length} transactions from localStorage`);
} else {
loadingElement.classList.add('hidden');
emptyElement.classList.remove('hidden');
}
return;
}
transactions = response;
populateTransactionsTable();
loadingElement.classList.add('hidden');
// Update debug info
document.getElementById('lastSync').textContent = new Date().toLocaleString('id-ID');
document.getElementById('dataLoaded').textContent = `${transactions.length} transactions`;
addDebugLog('info', `Loaded ${transactions.length} transactions from Google Sheets`);
} catch (error) {
console.error('Error loading transactions:', error);
// Coba load dari localStorage sebagai fallback
const localTransactions = JSON.parse(localStorage.getItem("transactionHistory") || "[]");
if (localTransactions.length > 0) {
transactions = localTransactions;
populateTransactionsTable();
loadingElement.classList.add('hidden');
showNotification('warning', 'Data Lokal', 'Menampilkan data dari localStorage karena Google Sheets tidak dapat diakses');
addDebugLog('warning', `Loaded ${localTransactions.length} transactions from localStorage due to error: ${error.message}`);
} else {
loadingElement.classList.add('hidden');
emptyElement.classList.remove('hidden');
showNotification('error', 'Error', 'Gagal memuat data transaksi');
addDebugLog('error', `Failed to load transactions: ${error.message}`);
}
}
}
// Populate transactions table
function populateTransactionsTable() {
const tableBody = document.getElementById('transactionsTableBody');
tableBody.innerHTML = '';
transactions.forEach(transaction => {
const row = document.createElement('tr');
row.className = 'transaction-row';
// Format date
const date = transaction.timestamp ? new Date(transaction.timestamp).toLocaleString('id-ID') : 
           transaction.date ? new Date(transaction.date).toLocaleString('id-ID') : '-';
const paymentMethod = transaction.metode || transaction.paymentMethod || '-';
const status = transaction.status || 'pending';
const username = transaction.pengguna || transaction.username || '-';
const robuxAmount = transaction.jumlah || transaction.robuxAmount || '-';
const price = transaction.harga || transaction.price || '-';
const id = transaction.id || '-';
row.innerHTML = `
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#${id.substring(0, 8)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${username}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${robuxAmount}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Rp ${parseInt(price).toLocaleString('id-ID')}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${date}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${getPaymentMethodLabel(paymentMethod)}</td>
<td class="px-6 py-4 whitespace-nowrap">
<span class="status-badge status-${status}">${getStatusLabel(status)}</span>
</td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
${status === 'pending' ? `
<button onclick="updateTransactionStatus('${id}', 'completed')" class="text-green-600 hover:text-green-900 mr-3">
<i class="fas fa-check"></i> Selesai
</button>
<button onclick="updateTransactionStatus('${id}', 'failed')" class="text-red-600 hover:text-red-900">
<i class="fas fa-times"></i> Gagal
</button>
` : '-'}
</td>
`;
tableBody.appendChild(row);
});
}
// Get payment method label
function getPaymentMethodLabel(method) {
switch (method) {
case 'qris': return 'QRIS';
case 'bank': return 'Transfer Bank';
case 'ewallet': return 'E-Wallet';
default: return method || '-';
}
}
// Get status label
function getStatusLabel(status) {
switch (status) {
case 'pending': return 'Menunggu';
case 'completed': return 'Selesai';
case 'failed': return 'Gagal';
default: return status;
}
}
// Refresh transactions
function refreshTransactions() {
loadTransactions();
showNotification('info', 'Memperbarui', 'Data transaksi sedang diperbarui');
}
// Export transactions
function exportTransactions() {
if (transactions.length === 0) {
showNotification('error', 'Error', 'Tidak ada data untuk diekspor');
return;
}
// Create CSV content
const headers = ['ID', 'Username', 'Jumlah Robux', 'Harga', 'Tanggal', 'Metode Pembayaran', 'Status'];
const csvContent = [
headers.join(','),
...transactions.map(t => [
t.id ? t.id.substring(0, 8) : '-',
t.pengguna || t.username || '-',
t.jumlah || t.robuxAmount || '-',
t.harga || t.price || '-',
t.timestamp ? new Date(t.timestamp).toLocaleString('id-ID') : t.date ? new Date(t.date).toLocaleString('id-ID') : '-',
getPaymentMethodLabel(t.metode || t.paymentMethod),
getStatusLabel(t.status || 'pending')
].join(','))
].join('\n');
// Create download link
const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
const link = document.createElement('a');
const url = URL.createObjectURL(blob);
link.setAttribute('href', url);
link.setAttribute('download', `transactions_${new Date().toISOString().split('T')[0]}.csv`);
link.style.visibility = 'hidden';
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
showNotification('success', 'Export Berhasil', 'Data transaksi berhasil diekspor');
addDebugLog('success', 'Transactions exported successfully');
}
// Update transaction status
async function updateTransactionStatus(transactionId, newStatus) {
try {
const result = await postDataToGoogleAppsScript("updateTransactionStatus", {
id: transactionId,
status: newStatus
});
console.log("Response dari Google Apps Script:", result);
showNotification('success', 'Berhasil', `Status transaksi diperbarui menjadi ${getStatusLabel(newStatus)}`);
addDebugLog('success', `Transaction ${transactionId} status updated to ${newStatus}`);
// Update di localStorage juga
const localTransactions = JSON.parse(localStorage.getItem("transactionHistory") || "[]");
const transactionIndex = localTransactions.findIndex(t => t.id === transactionId);
if (transactionIndex !== -1) {
localTransactions[transactionIndex].status = newStatus;
localStorage.setItem("transactionHistory", JSON.stringify(localTransactions));
}
// Reload transactions
loadTransactions();
// If analytics is open, reload it too
if (currentSection === 'analytics') {
loadAnalytics();
}
} catch (error) {
console.error('Error updating transaction:', error);
showNotification('error', 'Error', 'Gagal memperbarui status transaksi');
addDebugLog('error', `Failed to update transaction ${transactionId}: ${error.message}`);
}
}
// Load analytics data
function loadAnalytics() {
// Calculate statistics
const totalTransactions = transactions.length;
const completedTransactions = transactions.filter(t => (t.status || 'pending') === 'completed').length;
const pendingTransactions = transactions.filter(t => (t.status || 'pending') === 'pending').length;
const totalRevenue = transactions
.filter(t => (t.status || 'pending') === 'completed')
.reduce((sum, t) => sum + (parseInt(t.harga || t.price) || 0), 0);
// Update UI
document.getElementById('totalTransactions').textContent = totalTransactions;
document.getElementById('completedTransactions').textContent = completedTransactions;
document.getElementById('pendingTransactions').textContent = pendingTransactions;
document.getElementById('totalRevenue').textContent = `Rp ${totalRevenue.toLocaleString('id-ID')}`;
// Load recent transactions (last 5)
const recentTransactionsTable = document.getElementById('recentTransactionsTable');
recentTransactionsTable.innerHTML = '';
const recentTransactions = transactions.slice(0, 5);
if (recentTransactions.length === 0) {
recentTransactionsTable.innerHTML = `
<tr>
<td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">
Tidak ada transaksi terbaru
</td>
</tr>
`;
return;
}
recentTransactions.forEach(transaction => {
const row = document.createElement('tr');
const date = transaction.timestamp ? new Date(transaction.timestamp).toLocaleDateString('id-ID') : 
           transaction.date ? new Date(transaction.date).toLocaleDateString('id-ID') : '-';
const status = transaction.status || 'pending';
const username = transaction.pengguna || transaction.username || '-';
const robuxAmount = transaction.jumlah || transaction.robuxAmount || '-';
const id = transaction.id || '-';
row.innerHTML = `
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#${id.substring(0, 8)}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${username}</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${robuxAmount}</td>
<td class="px-6 py-4 whitespace-nowrap">
<span class="status-badge status-${status}">${getStatusLabel(status)}</span>
</td>
<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${date}</td>
`;
recentTransactionsTable.appendChild(row);
});
// Load chart
loadTransactionChart();
addDebugLog('info', 'Analytics data loaded');
}
// Load transaction chart
function loadTransactionChart() {
const ctx = document.getElementById('transactionChart').getContext('2d');
// Group transactions by date
const transactionsByDate = {};
transactions.forEach(t => {
const timestamp = t.timestamp || t.date;
if (timestamp) {
const date = new Date(timestamp).toLocaleDateString('id-ID');
if (!transactionsByDate[date]) {
transactionsByDate[date] = 0;
}
transactionsByDate[date]++;
}
});
// Get last 7 days
const labels = [];
const data = [];
for (let i = 6; i >= 0; i--) {
const date = new Date();
date.setDate(date.getDate() - i);
const dateStr = date.toLocaleDateString('id-ID');
labels.push(dateStr);
data.push(transactionsByDate[dateStr] || 0);
}
// Destroy existing chart
if (chart) {
chart.destroy();
}
// Create new chart
chart = new Chart(ctx, {
type: 'line',
data: {
labels: labels,
datasets: [{
label: 'Jumlah Transaksi',
data: data,
borderColor: 'rgb(59, 130, 246)',
backgroundColor: 'rgba(59, 130, 246, 0.1)',
tension: 0.1
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: {
display: false
}
},
scales: {
y: {
beginAtZero: true,
ticks: {
stepSize: 1
}
}
}
}
});
}
// Change password
function changePassword(event) {
event.preventDefault();
const newPassword = document.getElementById('newPassword').value;
const confirmPassword = document.getElementById('confirmPassword').value;
if (newPassword !== confirmPassword) {
showNotification('error', 'Error', 'Password dan konfirmasi password tidak cocok');
return;
}
if (newPassword.length < 6) {
showNotification('error', 'Error', 'Password minimal harus 6 karakter');
return;
}
// In a real app, you would update the password in a secure way
// For this demo, we'll just show a success message
showNotification('success', 'Berhasil', 'Password telah diperbarui');
document.getElementById('newPassword').value = '';
document.getElementById('confirmPassword').value = '';
addDebugLog('success', 'Admin password changed');
}
// Debug functions
function addDebugLog(type, message) {
const timestamp = new Date().toLocaleString('id-ID');
const log = {
type,
message,
timestamp
};
debugLogs.push(log);
// If debug section is open, update the UI
if (currentSection === 'debug') {
addDebugLogToUI(log);
}
}
function addDebugLogToUI(log) {
const debugPanel = document.getElementById('debugPanel');
const logElement = document.createElement('div');
logElement.className = `debug-log debug-${log.type}`;
logElement.innerHTML = `
<span class="text-gray-400">[${log.timestamp}]</span>
<span class="debug-${log.type}">${log.type.toUpperCase()}:</span> ${log.message}
`;
debugPanel.appendChild(logElement);
debugPanel.scrollTop = debugPanel.scrollHeight;
}
function loadDebugLogs() {
const debugPanel = document.getElementById('debugPanel');
debugPanel.innerHTML = '';
// Add existing logs
debugLogs.forEach(log => {
addDebugLogToUI(log);
});
// Add initial logs if empty
if (debugLogs.length === 0) {
addDebugLog('info', 'Google Apps Script initialized successfully');
addDebugLog('success', 'Admin login successful');
addDebugLog('info', `Loaded ${transactions.length} transactions`);
}
}
function clearDebugLogs() {
debugLogs = [];
const debugPanel = document.getElementById('debugPanel');
debugPanel.innerHTML = '<div class="debug-log debug-info"><span class="text-gray-400">[' + new Date().toLocaleString('id-ID') + ']</span> <span class="debug-info">INFO:</span> Debug logs cleared</div>';
}
// Notification system
function showNotification(type, title, message) {
const toast = document.getElementById('notificationToast');
const iconElement = document.getElementById('notificationIcon');
const titleElement = document.getElementById('notificationTitle');
const messageElement = document.getElementById('notificationMessage');
// Set icon based on type
if (type === 'success') {
iconElement.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
} else if (type === 'error') {
iconElement.innerHTML = '<i class="fas fa-exclamation-circle text-red-500"></i>';
} else if (type === 'warning') {
iconElement.innerHTML = '<i class="fas fa-exclamation-triangle text-yellow-500"></i>';
} else {
iconElement.innerHTML = '<i class="fas fa-info-circle text-blue-500"></i>';
}
// Set content
titleElement.textContent = title;
messageElement.textContent = message;
// Show toast
toast.classList.remove('translate-y-20', 'opacity-0');
// Hide after 5 seconds
setTimeout(() => {
hideNotification();
}, 5000);
}
function hideNotification() {
const toast = document.getElementById('notificationToast');
toast.classList.add('translate-y-20', 'opacity-0');
}
// Search functionality
document.getElementById('searchTransaction')?.addEventListener('input', function(e) {
const searchTerm = e.target.value.toLowerCase();
const rows = document.querySelectorAll('#transactionsTableBody tr');
rows.forEach(row => {
const text = row.textContent.toLowerCase();
row.style.display = text.includes(searchTerm) ? '' : 'none';
});
});
// Notification toggle
document.getElementById('notificationToggle')?.addEventListener('change', function() {
notificationEnabled = this.checked;
addDebugLog('info', `Notifications ${notificationEnabled ? 'enabled' : 'disabled'}`);
});
</script>
</body>
</html>
